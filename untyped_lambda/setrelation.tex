\section{Inductive Sets and Relations}


\begin{definition} The \emph{transitive closure} $\rplus{r}$ of a relation $r$ is
  defined by the rules
1.~$\rulev{r(a,b)}{\rplus{r}(a,b)}$,
2.~$\rulev{\rplus{r}(a,b) \\ r(b,c)}{\rplus{r}(a,c)}$
\end{definition}

\begin{definition} The \emph{reflexive transitive closure} $\rstar{r}$ of a relation $r$ is
  defined by the rules
1.~$\rulev{}{\rstar{r}(a,a)}$,
2.~$\rulev{\rstar{r}(a,b) \\ r(b,c)}{\rstar{r}(a,c)}$
\end{definition}

\begin{definition} The \emph{equivalence closure} $\reqv{r}$ of a relation $r$ is
  defined by the rules
  1.~$\rulev{}{\reqv{r}(a,a)}$,
  2.~$\rulev{\reqv{r}(a,b)
    \\ r(b,c)} {\reqv{r}(a,c)}$,
  3.~$\rulev{\reqv{r}(a,b) \\ r(c,b)} {\reqv{r}(a,c)}$
\end{definition}


% Closures are increasing, monotonic and idempotent
% -----------------------------------------
\begin{theorem}
  All closures are increasing $r \subseteq r^c$, monotonic
  $r \subseteq s \imp r^c \subseteq s^c$ and idempotent $r^{cc} = r$.
  \begin{proof}  We give a proof for the reflexive transitive closure. The
    proofs for the other closures are similar.
    \begin{itemize}
    \item
      Increasing: Goal $r(a,b) \imp \rstar{r}(a,b)$. By rule 1 we get
      $\rstar{r}(a,a)$. The assumption $r(a,b)$ and rule 2 imply
      $\rstar{r}(a,b)$.
      %
    \item
      Monotonic: Goal $\ruleh{r \subseteq s, \, \rstar{r}(a,b)}
      {\rstar{s}(a,b)}$. Prove by induction on $\rstar{r}(a,b)$.
        \begin{enumerate}
        \item Case $a=b$. Trivial by reflexivity of $\rstar{s}$.
        \item $\rstar{r}(a,c)$ is valid by rule 2. We have to prove
          $\rstar{s}(a,c)$.\\
          $
          \begin{matrix}
            a  & \to_{\rstar{r}} & b   &  \to_r   & c \\
                &    \Downarrow_1 & &  \Downarrow_2\\
            a  & \to_{\rstar{s}} & b   &  \to_s  &  c
          \end{matrix}$.\\
          $\Downarrow_1$ is valid by the induction
          hypothesis. $\Downarrow_2$ is valid by $r \subseteq s$. From the
          last line and the rule 2 of the reflexive transitive closure we can
          conclude $\rstar{s}(a,c)$.
        \end{enumerate}
    \item Idempotent: The equality of the relations $r^{**} = r^*$ needs a proof
      of $r^{**} \subseteq r^*$ and a proof of $r^* \subseteq r^{**}$.
      \begin{itemize}
      \item $ r^* \subseteq r^{**}$ is valid because the
        closure is increasing.
      \item
        Goal $r^{**}(a,b) \imp r^*(a,b)$. Proof by induction on $r^{**}(a,b)$.
        \begin{enumerate}
        \item
          Case $a=b$. Trivial by reflexivity.
        \item
          $
          \begin{matrix}
            a  & \to_{r^{**}} & b   &  \to_{r^*}   & c \\
                &    \Downarrow_1 & &  \Downarrow_2\\
            a  & \to_{r^*} & b   &     \to_{r^*}   &  c
          \end{matrix}$.
          $\Downarrow_1$ is valid by the induction
          hypothesis. $\Downarrow_2$ is trivial. $r^*$ is
          transitive. Therefore the last line implies $r^*(a,c)$.
        \end{enumerate}
      \end{itemize}
    \end{itemize}
  \end{proof}
\end{theorem}





\begin{theorem}
A relation $s$ which satisfies $r \subseteq s \subseteq r^c$ has the same closure
as $r$ i.e. $r^c = s^c$. Proof:
  \begin{itemize}
  \item $r^c \subseteq s^c$ by monotonicity.
  \item $s^c \subseteq r^c$: $s^c \subseteq r^{cc}$ by
    monotonicity and then use idempotence to conclude $s^c \subseteq r^c$.
  \end{itemize}
\end{theorem}



Theorems: $\rplus{r}$ is transitive, $\rstar{r}$ is transitive, $\reqv{r}$ is
symmetric, $\rplus{r}\subseteq\rstar{r}$, $r$ reflexive $\imp \rplus{r} =
\rstar{r}$.


\begin{definition}
  $a$ is a \emph{terminal element} of the relation $\to$ if it has no
  successor i.e. $\forall b: \neglow a \to b$.
\end{definition}

\begin{definition}
  $a$ is a \emph{terminating element} of the relation $\to$ if there is a path
  to a terminal element $b$ i.e. $a \tostar b$.
\end{definition}

\begin{definition}
A relation $\to$ is a \emph{diamond} if for all $a$, $b$ and $c$ there exists a $d$
such that
$
  \begin{matrix}
    a & \to & b \\
    \downarrow & & \downarrow \\
    c & \to & \exists d
  \end{matrix}
$
\end{definition}


\begin{definition}
  A relation $r$ is \emph{confluent} if $\rstar{r}$ is a diamond.
\end{definition}

\begin{theorem} In a confluent relation $r$ all two $r$-equivalent elements
  meet at some common element
  $
  \begin{matrix}
    a & \reqv\to & b \\
    & \rstar\searrow & \downarrow_*\\
    & & \exists c
  \end{matrix}
  $.
  Proof by induction on $a\reqv\to b$.
  \begin{enumerate}

  \item $a = b$. Trivial. Take $c = a$.

  \item
    $\begin{matrix}
      a & \reqv\to & b & \to & c\\
      & \rstar\searrow & \downarrow_*  & & \downarrow_*\\
      & & d? & \rstar\to & e?
    \end{matrix}$.
    $d$ exists by induction hypothesis, $e$ exists by confluence.

  \item
    $
    \begin{matrix}
      a & \reqv\to & b & \gets & c\\
      & \rstar\searrow & \downarrow_*  & & \downarrow_*\\
      & & d? & \rstar\to & e?
    \end{matrix}
    $.
    $d$ exists by induction hypothesis, $e$ exists by confluence.
  \end{enumerate}
\end{theorem}

Definition: $a$ is a terminal element of $r$ if $\neg r(a,b)$ for all $b$.

Definition: Set $\overline T$ of terminating elements of a relation $r$:
$\rulev{a\in T}{a\in \overline T}$, $\rulev{r(a,b) \\ b\in\overline T}{a\in
  \overline T}$ where $T$ is the set of terminal elements. By definition: For
all terminating elements $a$ there is a terminal element $b$ with $\rstar
r(a,b)$.

Theorem: In a confluent relation all terminating elements have a unique
terminal element. Proof: Suppose there are two terminal elements $b$ and $c$
for the terminating element $a$. By definition there must be a $d$ such that
$\begin{matrix} a & \tostar & b \\
  \downarrow_* & & \downarrow_* \\
  c & \tostar & d
\end{matrix}$
which contradicts the assumption that $b$ and $c$ are terminal.


Theorem: In a confluent relation $r$ two $r$-equivalent terminating elements have the same
terminal element.
Proof: Assume $a \reqv\to b$ and $a \to_* c$ and $b \to_* d$
where $c$ and $d$ are different terminal elements. Prove by induction on $a
\reqv\to b$. Case (a): $a=b$. By the previous theorem the terminal element
must be unique. Contradiction. Case (b): $a \reqv\to b$ and $b \to c$. By
induction hypothesis $a$ and $b$ must have the same terminal element.

Theorem: The reflexive transitive closure of a diamond is a diamond (stripe
lemma).
Proof:
\begin{itemize}
\item Lemma: Let $\to$ be a diamond. Then
$\begin{matrix}
a & \to_* & b \\
\downarrow & & \downarrow \\
c & \to_* & \exists d
  \end{matrix}$.
Proof by induction on $a \to_* b$.
\begin{itemize}
\item Case (a): $a = b$. Trivial, take $d=c$.
\item Case (b):
$\begin{matrix}
a & \to_* & b & \to & c\\
\downarrow & & \downarrow & & \downarrow\\
d & \to_* & e? & \to & f?
\end{matrix}$. $e$ exists by the induction hypothesis, $f$ exists because
$\to$ is a diamond.
\end{itemize}

\item Theorem:  Let $\to$ be a diamond. Then
$\begin{matrix}
a & \to_* & b \\
\downarrow_* & & \downarrow_* \\
c & \to_* & \exists d
  \end{matrix}$. Proof by induction on $a \to_* c$.
\begin{itemize}
\item Case (a): $a = b$. Trivial, take $d=c$.
\item Case (b):
$\begin{matrix}
a & \to_* & b\\
\downarrow_* & & \downarrow_* \\
c & \to_* & e?  \\
\downarrow & & \downarrow \\
d & \to_* & f?
\end{matrix}$. $e$ exists by induction hypothesis, $f$ exists by the previous lemma.
\end{itemize}
\end{itemize}
